\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{datetime2-romano-latino}[2015/05/10 v1.0]
\DeclareOption*{\PassOptionsToPackage{\CurrentOption}{datetime2}}
\ProcessOptions
\RequirePackage{datetime2}

%\RequirePackage{ifxetex,ifluatex}
%\ifxetex
%\RequireDateTimeModule{latino-utf8}
%\else
%\ifluatex
%\RequireDateTimeModule{latino-utf8}
%\else
%\RequireDateTimeModule{latino-ascii}
%\fi
%\fi
%\def\CurrentTrackedDialect{italian}
%\RequireDateTimeModule{italian}
%\undef\CurrentTrackedDialect
\newcounter{countS}
\newcounter{countT}
\newcounter{countM}
\newcommand{\stamparoman}[1]{\space{\uppercase\expandafter{\romannumeral#1}}}
\newcommand{\stampaanno}[1]{%
	\setcounter{countS}{#1}
	\setcounter{countM}{-1}
	\ifnumcomp{#1}{>}{0}{%
		\addtocounter{countS}{753}ANNO--\stamparoman{#1}--PCN--VEL--\stamparoman{\thecountS}--AUC}{\setcounter{countS}{\numexpr\thecountM*\thecountS}
		\setcounter{countT}{\thecountS}%
		\setcounter{countS}{\numexpr 754-\thecountS}%
		ANNO--\stamparoman{\thecountT}--ACN--VEL--\stamparoman{\thecountS}--AUC}}
\newbool{compatta}
\setbool{compatta}{false}
\input{temp}
\newcounter{countA}
\newtoggle{bisestile}
\newcommand{\testbisestile}[1]{
	\setcounter{countA}{#1}
	\ifnumcomp{#1}{>}{1582}{
		\ifboolexpr{
			(test{ \ifnumcomp{(\value{countA}/4)*4-\value{countA}}{=}{0}}
			and not test  {\ifnumcomp{(\value{countA}/100)*100-\value{countA}}{=}{0}})
			or test {\ifnumcomp{(\value{countA}/400)*400-\value{countA}}{=}{0}}
		}{\toggletrue{bisestile}}{\togglefalse{bisestile}}
	}
	{\ifnumcomp{(\value{countA}/4)*4-\value{countA}}{=}{0}
		{\toggletrue{bisestile}}{\togglefalse{bisestile}}}}

\newcommand*{\DTMlatinoMensis}[1]{%
	\ifcase#1
	\or
	Ianuarius%
	\or
	Februarius%
	\or
	Martius%
	\or
	Aprilis%
	\or
	Maius%
	\or
	Iunius%
	\or
	Quintilis%
	\or
	Sextilis%
	\or
	Septemper%
	\or
	October%
	\or
	November%
	\or
	December%
	\fi
}
\newcommand*{\DTMlatinoMensisDurata}[1]{%
	\ifcase#1
	\or
	31%
	\or
	28%
	\or
	31%
	\or
	30%
	\or
	31%
	\or
	30%
	\or
	31%
	\or
	31%
	\or
	30%
	\or
	31%
	\or
	30%
	\or
	31%
	\fi
}
\newcommand*{\DTMlatinoNonae}[1]{%
	\ifcase#1
	\or
	5%
	\or
	5%
	\or
	7%
	\or
	5%
	\or
	7%
	\or
	5%
	\or
	7%
	\or
	5%
	\or
	5%
	\or
	7%
	\or
	5%
	\or
	5%
	\fi
}

\newcommand*{\DTMlatinoPridieNonae}[1]{%
	\ifcase#1
	\or
	4%
	\or
	4%
	\or
	6%
	\or
	4%
	\or
	6%
	\or
	4%
	\or
	6%
	\or
	4%
	\or
	4%
	\or
	6%
	\or
	4%
	\or
	4%
	\fi
}

\newcommand*{\DTMlatinoIdus}[1]{%
	\ifcase#1
	\or
	13%Ianuarius%
	\or
	13%Februarius%
	\or
	15%Martius%
	\or
	13%Aprilis%
	\or
	15%Maius%
	\or
	13%Iunius%
	\or
	15%Iulius%
	\or
	13%Augustus%
	\or
	13%Septemper%
	\or
	15%October%
	\or
	13%November%
	\or
	13%December%
	\fi}

\newcommand*{\DTMlatinoPridieIdus}[1]{%
	\ifcase#1
	\or
	12%Ianuarius%
	\or
	12%Februarius%
	\or
	14%Martius%
	\or
	12%Aprilis%
	\or
	14%Maius%
	\or
	12%Iunius%
	\or
	14%Iulius%
	\or
	12%Augustus%
	\or
	12%Septemper%
	\or
	14%October%
	\or
	12%November%
	\or
	12%December%
	\fi}

\newcommand*{\DTMlatinoHora}[1]{%
	\ifcase#1%
	tertia vigilia%
	\or
	tertia vigilia%
	\or
	tertia vigilia%
	\or
	tertia vigilia%
	\or
	quarta vigilia%
	\or
	quarta vigilia%
	\or
	quarta vigilia%
	\or
	hora prima%
	\or
	hora secunda%
	\or
	hora tertia%
	\or
	hora quarta%
	\or
	hora quinta%
	\or
	hora sexta%
	\or
	hora septima%
	\or
	hora octava%
	\or
	hora nona%
	\or
	hora decima%
	\or
	hora undecima%
	\or
	hora duodecima%
	\or
	prima vigilia%
	\or
	prima vigilia%
	\or
	secunda vigilia%
	\or
	secunda vigilia%
	\or
	secunda vigilia%
	\or
	secunda vigilia% 
	\fi
}
\newcommand{\DTMlatinoAnteDiemuno}[2]{%
\DTMlatinoAnteDiem{\number\numexpr(\number\DTMlatinoNonae{#1}-\number#2+1)\relax}\space\DTMlatinoPridieNonaeNome{#1}}%
\newcommand{\DTMlatinoAnteDiemdue}[2]{%
\DTMlatinoAnteDiem{\number\numexpr(\number\DTMlatinoIdus{#1}-\number#2+1)\relax}\space\DTMlatinoPridieIdusNome{#1}}%
\newcommand{\DTMlatinoAnteDiemtre}[2]{%
\DTMlatinoAnteDiem{\number\numexpr(\number\DTMlatinoMensisDurata{#1}-\number#2+2)\relax}\space\DTMlatinoPridieKalendasNome{#1}}%
\newcommand{\DTMlatinoAnteDiemquattro}[1]{%
\DTMlatinoAnteDiemBis{\number\numexpr(29-\number#1+2)\relax}}%
\DTMnewdatestyle{latino-Kalendae}{%
\renewcommand*\DTMdisplaydate[4]{%
\testbisestile{##1}%
\ifnum##3=1\DTMlatinoKalendis{##2}\fi%kalenda
\ifnum##3=\DTMlatinoPridieNonae{##2}\DTMlatinoMensisPridie\DTMlatinoPridieNonaeNome{##2}\fi%
\ifnum##3=\DTMlatinoNonae{##2}\DTMlatinoNonaeNome{##2}\fi%
\ifnum##3=\DTMlatinoIdus{##2}\DTMlatinoIdusNome{##2}\fi%
\ifboolexpr{
	test {\ifnumcomp{##2}{=}{2}}
	and test {\iftoggle{bisestile}}}
{\ifnum##3=29 pridie Kalendas Martias\fi}%
{\ifnum##3=\DTMlatinoMensisDurata{##2}\DTMlatinoMensisPridie\DTMlatinoPridieKalendasNome{##2}\fi}%
\ifnum##3=\DTMlatinoPridieIdus{##2}\DTMlatinoMensisPridie\DTMlatinoPridieIdusNome{##2}\fi%
\ifboolexpr{%
	test {\ifnumless{##3}{\DTMlatinoPridieNonae{##2}}}%
	and
	test{\ifnumgreater{##3}{1}}}%
{\DTMlatinoAnteDiemuno{##2}{##3}}{}%
\ifboolexpr{%
	test {\ifnumless{##3}{\DTMlatinoPridieIdus{##2}}}%
	and
	test{\ifnumgreater{##3}{\DTMlatinoNonae{##2}}}}%
{\DTMlatinoAnteDiemdue{##2}{##3}}{}%%
\ifboolexpr{%
	test {\ifnumcomp{##2}{=}{2}}
	and test {\iftoggle{bisestile}}}
{\ifboolexpr{%
		test {\ifnumless{##3}{29}}%
		and
		test{\ifnumgreater{##3}{\DTMlatinoIdus{##2}}}}%
	{\DTMlatinoAnteDiemquattro{##3}}{}}%
{\ifboolexpr{%
		test {\ifnumless{##3}{\DTMlatinoMensisDurata{##2}}}%
		and
		test{\ifnumgreater{##3}{\DTMlatinoIdus{##2}}}}%
{\DTMlatinoAnteDiemtre{##2}{##3}}{}}%
\stampaanno{##1}
}%
}%

\DTMnewdatestyle{latino-Kalendae-abb}{%
\setbool{compatta}{true}	
	\renewcommand*\DTMdisplaydate[4]{%
		\testbisestile{##1}%
	\ifnum##3=1\DTMlatinoKalendis{##2}\fi%kalenda
	\ifnum##3=\DTMlatinoPridieNonae{##2}\DTMlatinoMensisPridie\DTMlatinoPridieNonaeNome{##2}\fi%
	\ifnum##3=\DTMlatinoNonae{##2}\DTMlatinoNonaeNome{##2}\fi%
	\ifnum##3=\DTMlatinoIdus{##2}\DTMlatinoIdusNome{##2}\fi%
	\ifboolexpr{%
		test {\ifnumcomp{##2}{=}{2}}
		and test {\iftoggle{bisestile}}}
	{\ifnum##3=29 pridie Kalendas Martias\fi}%
{\ifnum##3=\DTMlatinoMensisDurata{##2}\DTMlatinoMensisPridie\DTMlatinoPridieKalendasNome{##2}\fi}%
	\ifnum##3=\DTMlatinoPridieIdus{##2}\DTMlatinoMensisPridie\DTMlatinoPridieIdusNome{##2}\fi%
	\ifboolexpr{test {\ifnumless{##3}{\DTMlatinoPridieNonae{##2}}}%
		and	test{\ifnumgreater{##3}{1}}}%
		{\DTMlatinoAnteDiemuno{##2}{##3}}{}%
		\ifboolexpr{%
			test {\ifnumless{##3}{\DTMlatinoPridieIdus{##2}}}%
			and
			test{\ifnumgreater{##3}{\DTMlatinoNonae{##2}}}}%
		{\DTMlatinoAnteDiemdue{##2}{##3}}{}%%
		\ifboolexpr{%
			test {\ifnumcomp{##2}{=}{2}}
			and test {\iftoggle{bisestile}}}%
		{\ifboolexpr{%
				test {\ifnumless{##3}{29}}%
				and
				test{\ifnumgreater{##3}{\DTMlatinoIdus{##2}}}}%
			{\DTMlatinoAnteDiemquattro{##3}}{}}%
		{\ifboolexpr{%
				test {\ifnumless{##3}{\DTMlatinoMensisDurata{##2}}}%
				and
				test{\ifnumgreater{##3}{\DTMlatinoIdus{##2}}}}%
			{\DTMlatinoAnteDiemtre{##2}{##3}}{}}%
	\stampaanno{##1}
	}%
}%




\DTMnewtimestyle{latino-Hora}{%
	\DTMshowzonefalse
	\renewcommand\DTMdisplaytime[3]{%
	\DTMlatinoHora{##1}%
	}%
}%
\newcommand*{\DTMlatinozonemaps}{%
	\DTMdefzonemap{01}{00}{}%
	\DTMdefzonemap{02}{00}{}%
}
