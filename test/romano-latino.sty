\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{romano-latino}[2015/05/10 v1.0]
\RequirePackage{xspace}
\RequirePackage[latin]{babel}
\RequirePackage{etoolbox}

\newcounter{countA}
\newtoggle{bisestile}
\togglefalse{bisestile}
%\newcommand{\testbisestile}[1]{
%	\setcounter{countA}{#1}
%	\ifnumcomp{(\value{countA}/4)*4-\value{countA}}{=}{0}
%	{\toggletrue{bisestile}}{\togglefalse{bisestile}}
%}

\newcommand{\testbisestile}[1]{
	\setcounter{countA}{#1}
	\ifnumcomp{#1}{>}{1582}{
		\ifboolexpr{
			(test{ \ifnumcomp{(\value{countA}/4)*4-\value{countA}}{=}{0}}
			and not test  {\ifnumcomp{(\value{countA}/100)*100-\value{countA}}{=}{0}})
			or test {\ifnumcomp{(\value{countA}/400)*400-\value{countA}}{=}{0}}
		}{\toggletrue{bisestile}}{\togglefalse{bisestile}}%gregoriano
	}
	{\ifnumcomp{(\value{countA}/4)*4-\value{countA}}{=}{0}
	{\toggletrue{bisestile}}{\togglefalse{bisestile}}%giuliano
	}
}


\newcommand{\latinoMensisPridie}{Pridie\space}
\newcommand*{\latinoMensis}[1]{%
	\ifcase#1
	\or
	Ianuarius%
	\or
	Februarius%
	\or
	Martius%
	\or
	Aprilis%
	\or
	Maius%
	\or
	Iunius%
	\or
	Quintilis%
	\or
	Sextilis%
	\or
	Septemper%
	\or
	October%
	\or
	November%
	\or
	December%
	\fi
}
\newcommand*{\latinoMensisDurata}[1]{%
	\ifcase#1
	\or
	31%
	\or
	28%
	\or
	31%
	\or
	30%
	\or
	31%
	\or
	30%
	\or
	31%
	\or
	31%
	\or
	30%
	\or
	31%
	\or
	30%
	\or
	31%
	\fi
}
\newcommand*{\latinoNonae}[1]{%
	\ifcase#1
	\or
	5%
	\or
	5%
	\or
	7%
	\or
	5%
	\or
	7%
	\or
	5%
	\or
	7%
	\or
	5%
	\or
	5%
	\or
	7%
	\or
	5%
	\or
	5%
	\fi
}
\newcommand*{\latinoNonaeNome}[1]{%
	\ifcase#1
	\or
Nonis Ianuariis%
\or
Nonis Februariis%
\or
Nonis Martiis%
\or
Nonis Aprilibus%
\or
Nonis Maiis%
\or
Nonis Iuniis%
\or
Nonis Quintilibus%
\or
Nonis Sextilibus%
\or
Nonis Septembribus%
\or
Nonis Octobribus%
\or
Nonis Nouembribus%
\or
Nonis Decembribus%
	\fi
}
\newcommand*{\latinoPridieNonae}[1]{%
	\ifcase#1
	\or
	4%
	\or
	4%
	\or
	6%
	\or
	4%
	\or
	6%
	\or
	4%
	\or
	6%
	\or
	4%
	\or
	4%
	\or
	6%
	\or
	4%
	\or
	4%
	\fi
}
\newcommand*{\latinoPridieNonaeNome}[1]{%
	\ifcase#1
	\or
Nonas Ianuarias%
\or
Nonas Februarias%
\or
Nonas Martias%
\or
Nonas Apriles%
\or
Nonas Maias%
\or
Nonas Iunias%
\or
Nonas Quintiles%
\or
Nonas Sextiles%
\or
Nonas Septembres%
\or
Nonas Octobres%
\or
Nonas Nouembres%
\or
Nonas Decembres%
	\fi
}
\newcommand*{\latinoIdus}[1]{%
	\ifcase#1
	\or
	13%Ianuarius%
	\or
	13%Februarius%
	\or
	15%Martius%
	\or
	13%Aprilis%
	\or
	15%Maius%
	\or
	13%Iunius%
	\or
	15%Iulius%
	\or
	13%Augustus%
	\or
	13%Septemper%
	\or
	15%October%
	\or
	13%November%
	\or
	13%December%
	\fi
}
\newcommand*{\latinoIdusNome}[1]{%
	\ifcase#1
	\or
Idibus Ianuariis%
\or
Idibus Februariis%
\or
Idibus Martiis%
\or
Idibus Aprilibus%
\or
Idibus Maiis%
\or
Idibus Iuniis%
\or
Idibus Quintilibus%
\or
Idibus Sextilibus%
\or
Idibus Septembribus%
\or
Idibus Octobribus%
\or
Idibus Nouembribus%
\or
Idibus Decembribus%
	\fi
}

\newcommand*{\latinoPridieIdus}[1]{%
	\ifcase#1
	\or
	12%Ianuarius%
	\or
	12%Februarius%
	\or
	14%Martius%
	\or
	12%Aprilis%
	\or
	14%Maius%
	\or
	12%Iunius%
	\or
	14%Iulius%
	\or
	12%Augustus%
	\or
	12%Septemper%
	\or
	14%October%
	\or
	12%November%
	\or
	12%December%
	\fi
}
\newcommand*{\latinoPridieIdusNome}[1]{%
	\ifcase#1
\or
Idus Ianuarias%
\or
Idus Februarias%
\or
Idus Martias%
\or
Idus Apriles
\or 
Idus Maias%
\or
Idus Iunias%
\or
Idus Quintiles%
\or
Idus Sextiles%
\or
Idus Septembres%
\or
Idus Octobres%
\or
Idus Nouembres%
\or
Idus Decembres
	\fi
}
\newcommand*{\latinoPridieKalendasNome}[1]{%
	\ifcase#1
\or
Kalendas Februarias%
\or
Kalendas Martias%
\or
Kalendas Apriles%
\or
Kalendas Maias%
\or
Kalendas Iunias%
\or
Kalendas Quintiles%
\or
Kalendas Sextiles%
\or
Kalendas Septembres%
\or
Kalendas Octobres
\or
Kalendas Nouembres%
\or
Kalendas Secembres%
\or
Kalendas Ianuarias%
	\fi
}
\newcommand*{\latinoKalendis}[1]{%
	\ifcase#1
	\or
Kalendis Ianuariis%
\or
Kalendis Februariis
\or
Kalendis Martiis%
\or
Kalendis Aprilibus%
\or
Kalendis Maiis%
\or
Kalendis Iuniis%
\or
Kalendis Quintilibus%
\or
Kalendis Sextilibus%
\or
Kalendis Septembribus%
\or
Kalendis Octobribus%
\or
Kalendis Nouembribus%
\or
Kalendis Decembribus%
	\fi
}
\newcommand*{\latinoAnteDiem}[1]{%
	\ifcase#1
	\or
1%
\or
2%
\or
ante diem tertium%
\or
ante diem quartum%
\or
ante diem quintum%
\or
ante diem sextum%
\or
ante diem septimum%
\or
ante diem octavum%
\or
ante diem nonum%
\or
ante diem decimum%
\or
ante diem undecimum%
\or
ante diem duodecimum%
\or
ante diem tertium decimum%
\or
ante diem quartum decimum%
\or
ante diem quintum decimum%
\or
ante diem sextum decimum%
\or
ante diem septimum decimum%
\or
ante diem duodevicesimum%
\or
ante diem undevicesimum%
	\fi
}
\newcommand*{\latinoAnteDiemBis}[1]{%
	\ifcase#1
	\or
	1%
	\or
	2%
	\or
	ante diem tertium Kalendas Martias%
	\or
	ante diem quartum Kalendas Martias%
	\or
 ante diem quintum Kalendas Martias%
 \or
 ante diem bis sextum Kalendas Martias%
	\or
	ante diem sextum Kalendas Martias%
	\or
	ante diem septimum Kalendas Martias%
	\or
	ante diem octavum Kalendas Martias%
	\or
	ante diem nonum Kalendas Martias%
	\or
	ante diem decimum Kalendas Martias%
	\or
	ante diem undecimum Kalendas Martias%
	\or
	ante diem duodecimum Kalendas Martias%
	\or
	ante diem tertium decimum Kalendas Martias%
	\or
	ante diem quartum decimum Kalendas Martias%
	\or
	ante diem quintum decimum Kalendas Martias%
	\or
	ante diem sextum decimum Kalendas Martias%
	\or
	ante diem septimum decimum Kalendas Martias%
	\or
	ante diem duodevicesimum Kalendas Martias%
	\or
	ante diem undevicesimum Kalendas Martias%
	\fi
}
\newcommand*{\latinoHora}[1]{%
	\ifcase#1
	tertia vigilia%
	\or
	tertia vigilia%
	\or
	tertia vigilia%
	\or
	tertia vigilia%
	\or
	quarta vigilia%
	\or
	quarta vigilia%
	\or
	quarta vigilia%
	\or
	hora prima%
	\or
	hora secunda%
	\or
	hora tertia%
	\or
	hora quarta%
	\or
	hora quinta%
	\or
	hora sexta%
	\or
	hora septima%
	\or
	hora octava%
	\or
	hora nona%
	\or
	hora decima%
	\or
	hora undecima%
	\or
	hora duodecima%
	\or
	prima vigilia%
	\or
	prima vigilia%
	\or
	secunda vigilia%
	\or
	secunda vigilia%
	\or
	secunda vigilia%
	\or
	secunda vigilia% 
	\fi
}

\newcommand{\latinoAnteDiemuno}[2]{%
\latinoAnteDiem{\number\numexpr(\number\latinoNonae{#1}-\number#2+1)\relax}\space\latinoPridieNonaeNome{#1}}%
\newcommand{\latinoAnteDiemdue}[2]{%
\latinoAnteDiem{\number\numexpr(\number\latinoIdus{#1}-\number#2+1)\relax}\space\latinoPridieIdusNome{#1}}%
\newcommand{\latinoAnteDiemtre}[2]{%
\latinoAnteDiem{\number\numexpr(\number\latinoMensisDurata{#1}-\number#2+2)\relax}\space\latinoPridieKalendasNome{#1}}%
\newcommand{\latinoAnteDiemquattro}[1]{%
\latinoAnteDiemBis{\number\numexpr(29-\number#1+2)\relax}}%

\renewcommand\datelatin{\def\today{\number\day%da togliere solo per test
		\space\testbisestile{\number\year}
		\ifnum\number\day=1\latinoKalendis{\number\month}\fi%kalenda
		\ifnum\number\day=\latinoPridieNonae{\number\month}\latinoMensisPridie\latinoPridieNonaeNome{\number\month}\fi%
		\ifnum\number\day=\latinoNonae{\number\month}\latinoNonaeNome{\number\month}\fi%
		\ifnum\number\day=\latinoIdus{\number\month}\latinoIdusNome{\number\month}\fi%
\ifboolexpr{
	test {\ifnumcomp{\number\month}{=}{2}}
	and test {\iftoggle{bisestile}}}
{\ifnum\number\day=29 pridie Kalendas Martias\fi}%
{\ifnum\number\day=\latinoMensisDurata{\number\month}\latinoMensisPridie\latinoPridieKalendasNome{\number\month}\fi}%
\ifnum\number\day=\latinoPridieIdus{\number\month}\latinoMensisPridie\latinoPridieIdusNome{\number\month}\fi%
\ifboolexpr{%
	test {\ifnumless{\number\day}{\latinoPridieNonae{\number\month}}}%
	and
	test{\ifnumgreater{\number\day}{1}}}%
{\latinoAnteDiemuno{\number\month}{\number\day}}{}%
\ifboolexpr{%
	test {\ifnumless{\number\day}{\latinoPridieIdus{\number\month}}}%
	and
	test{\ifnumgreater{\number\day}{\latinoNonae{\number\month}}}}%
{\latinoAnteDiemdue{\number\month}{\number\day}}{}%%
\ifboolexpr{%
	test {\ifnumcomp{\number\month}{=}{2}}
	and test {\iftoggle{bisestile}}}
{\ifboolexpr{%
		test {\ifnumless{\number\day}{29}}%
		and
		test{\ifnumgreater{\number\day}{\latinoIdus{\number\month}}}}%
	{\latinoAnteDiemquattro{\number\day}}{}}%
{\ifboolexpr{%
		test {\ifnumless{\number\day}{\latinoMensisDurata{\number\month}}}%
		and
		test{\ifnumgreater{\number\day}{\latinoIdus{\number\month}}}}%
{\latinoAnteDiemtre{\number\month}{\number\day}}{}}%

		}}


	
\def\data#1/#2/#3 {% Lo spazio prima della graffa Ã¨ significativo
	\day=#3\relax
	\month=#2\relax
	\year=#1\relax
	\today\xspace}
